{"version":3,"file":"cs-client.js","sourceRoot":"","sources":["../../../../client-src/js-src/cs-client.js"],"names":[],"mappings":"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","sourcesContent":["/**\n * Copyright 2021 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @typedef {object} FeatureLink\n * @property {string} url\n * @property {string} type\n * @property {object} information - fields depend on type; see link_helpers.py\n * @property {number} http_error_code\n */\n\n// prettier-ignore\n(function(exports) {\n'use strict';\n\n/**\n * Generic Chrome Status Http Error.\n */\nclass ChromeStatusHttpError extends Error {\n  constructor(message, resource, method, status) {\n    super(message);\n    this.name = 'ChromeStatusHttpError';\n    this.resource = resource;\n    this.method = method;\n    this.status = status;\n  }\n}\n\n/**\n * FeatureNotFoundError represents an error for when a feature was not found\n * for the given ID.\n */\nclass FeatureNotFoundError extends Error {\n  constructor(featureID) {\n    super('Feature not found');\n    this.name = 'FeatureNotFoundError';\n    this.featureID = featureID;\n  }\n}\n\nclass ChromeStatusClient {\n  constructor(token, tokenExpiresSec) {\n    this.token = token;\n    this.tokenExpiresSec = tokenExpiresSec;\n    this.baseUrl = '/api/v0'; // Same scheme, host, and port.\n  }\n\n  /* Refresh the XSRF token if necessary. */\n  async ensureTokenIsValid() {\n    if (ChromeStatusClient.isTokenExpired(this.tokenExpiresSec)) {\n      const refreshResponse = await this.doFetch(\n        '/currentuser/token', 'POST', null);\n      this.token = refreshResponse.token;\n      this.tokenExpiresSec = refreshResponse.token_expires_sec;\n    }\n  }\n\n  /* Return true if the XSRF token has expired. */\n  static isTokenExpired(tokenExpiresSec) {\n    const tokenExpiresDate = new Date(tokenExpiresSec * 1000);\n    return tokenExpiresDate < new Date();\n  }\n\n  /* Make a JSON API call to the server, including an XSRF header.\n   * Then strip off the defensive prefix from the response. */\n  async doFetch(resource, httpMethod, body, includeToken=true) {\n    const url = this.baseUrl + resource;\n    const headers = {\n      'accept': 'application/json',\n      'content-type': 'application/json',\n    };\n    if (includeToken) {\n      headers['X-Xsrf-Token'] = this.token;\n    }\n    const options = {\n      method: httpMethod,\n      credentials: 'same-origin',\n      headers: headers,\n    };\n    if (body !== null) {\n      options['body'] = JSON.stringify(body);\n    }\n\n    const response = await fetch(url, options);\n\n    if (response.status !== 200) {\n      throw new ChromeStatusHttpError(\n        `Got error response from server ${resource}: ${response.status}`,\n        resource,\n        httpMethod,\n        response.status);\n    }\n    const rawResponseText = await response.text();\n    const XSSIPrefix = ')]}\\'\\n';\n    if (!rawResponseText.startsWith(XSSIPrefix)) {\n      throw new Error(\n          `Response does not start with XSSI prefix: ${XSSIPrefix}`);\n    }\n    return JSON.parse(rawResponseText.substr(XSSIPrefix.length));\n  }\n\n  async doGet(resource, body) {\n    // GET's do not use token.\n    return this.doFetch(resource, 'GET', body, false);\n  }\n\n  async doPost(resource, body) {\n    return this.ensureTokenIsValid().then(() => {\n      return this.doFetch(resource, 'POST', body);\n    });\n  }\n\n  async doPatch(resource, body) {\n    return this.ensureTokenIsValid().then(() => {\n      return this.doFetch(resource, 'PATCH', body);\n    });\n  }\n\n  async doDelete(resource) {\n    return this.ensureTokenIsValid().then(() => {\n      return this.doFetch(resource, 'DELETE', null);\n    });\n  }\n\n\n  // //////////////////////////////////////////////////////////////\n  // Specific API calls\n\n  // Signing in and out\n\n  signIn(credentialResponse) {\n    const credential = credentialResponse.credential;\n    // We don't use doPost because we don't already have a XSRF token.\n    return this.doFetch('/login', 'POST', {'credential': credential}, false);\n  }\n\n  signOut() {\n    return this.doPost('/logout');\n  }\n\n  // Cues API\n\n  getDismissedCues() {\n    return this.doGet('/currentuser/cues');\n  }\n\n  dismissCue(cue) {\n    return this.doPost('/currentuser/cues', {cue: cue})\n      .then((res) => res);\n    // TODO: catch((error) => { display message }\n  }\n\n  // Permissions API\n  getPermissions(returnPairedUser=false) {\n    let url = '/currentuser/permissions';\n    if (returnPairedUser) {\n      url += '?returnPairedUser';\n    }\n    return this.doGet(url)\n      .then((res) => res.user);\n  }\n\n  // Settings API\n\n  getSettings() {\n    return this.doGet('/currentuser/settings');\n  }\n\n  setSettings(notify) {\n    return this.doPost('/currentuser/settings', {notify: notify});\n  }\n\n  // Star API\n\n  getStars() {\n    return this.doGet('/currentuser/stars')\n      .then((res) => res.featureIds);\n    // TODO: catch((error) => { display message }\n  }\n\n  setStar(featureId, starred) {\n    return this.doPost(\n      '/currentuser/stars',\n      {featureId: featureId, starred: starred})\n      .then((res) => res);\n    // TODO: catch((error) => { display message }\n  }\n\n  // Accounts API\n\n  createAccount(email, isAdmin, isSiteEditor) {\n    return this.doPost('/accounts', {email, isAdmin, isSiteEditor});\n    // TODO: catch((error) => { display message }\n  }\n\n  deleteAccount(accountId) {\n    return this.doDelete('/accounts/' + accountId);\n    // TODO: catch((error) => { display message }\n  }\n\n  getVotes(featureId, gateId) {\n    if (gateId) {\n      return this.doGet(`/features/${featureId}/votes/${gateId}`);\n    }\n    return this.doGet(`/features/${featureId}/votes`);\n  }\n\n  setVote(featureId, gateId, state) {\n    return this.doPost(\n        `/features/${featureId}/votes/${gateId}`,\n        {state: Number(state)});\n  }\n\n  getGates(featureId) {\n    return this.doGet(`/features/${featureId}/gates`);\n  }\n\n  getPendingGates() {\n    return this.doGet('/gates/pending');\n  }\n\n  updateGate(featureId, gateId, assignees) {\n    return this.doPost(\n        `/features/${featureId}/gates/${gateId}`,\n        {assignees,\n        });\n  }\n\n  getComments(featureId, gateId) {\n    let url = `/features/${featureId}/approvals/comments`;\n    if (gateId) {\n      url = `/features/${featureId}/approvals/${gateId}/comments`;\n    }\n    return this.doGet(url);\n  }\n\n  postComment(featureId, gateId, comment, postToThreadType) {\n    if (gateId) {\n      return this.doPost(\n          `/features/${featureId}/approvals/${gateId}/comments`,\n          {comment, postToThreadType});\n    } else {\n      return this.doPost(\n          `/features/${featureId}/approvals/comments`,\n          {comment, postToThreadType});\n    }\n  }\n\n  deleteComment(featureId, commentId) {\n    return this.doPatch(\n      `/features/${featureId}/approvals/comments`,\n      {commentId, isUndelete: false},\n    );\n  }\n\n  undeleteComment(featureId, commentId) {\n    return this.doPatch(\n      `/features/${featureId}/approvals/comments`,\n      {commentId, isUndelete: true},\n    );\n  }\n\n  // Features API\n  async getFeature(featureId) {\n    return this.doGet(`/features/${featureId}`)\n      .catch((error) => {\n        // If not the ChromeStatusHttpError, continue throwing.\n        if (!(error instanceof ChromeStatusHttpError)) {\n          throw error;\n        }\n        // Else, do further validations\n        if (error.status === 404) {\n          throw new FeatureNotFoundError(featureId);\n        }\n        // No other special cases means, we can re throw the error.\n        throw error;\n      });\n  }\n\n  async getFeaturesInMilestone(milestone) {\n    return this.doGet(`/features?milestone=${milestone}`).then(\n      (resp) => resp['features_by_type']);\n  }\n\n  async getFeaturesForEnterpriseReleaseNotes(milestone) {\n    return this.doGet(`/features?releaseNotesMilestone=${milestone}`);\n  }\n\n  async searchFeatures(userQuery, showEnterprise, sortSpec, start, num) {\n    let url = `/features?q=${userQuery}`;\n    if (showEnterprise) {\n      url += '&showEnterprise';\n    }\n    if (sortSpec) {\n      url += '&sort=' + sortSpec;\n    }\n    if (start) {\n      url += '&start=' + start;\n    }\n    if (num) {\n      url += '&num=' + num;\n    }\n    return this.doGet(url);\n  }\n\n  async updateFeature(featureChanges) {\n    return this.doPatch('/features', featureChanges);\n  }\n\n  // FeatureLinks API\n\n  /**\n   * @param {number} featureId\n   * @returns {Promise<{data: FeatureLink[], has_stale_links: boolean}>}\n   */\n  async getFeatureLinks(featureId, updateStaleLinks=true) {\n    return this.doGet(`/feature_links?feature_id=${featureId}&update_stale_links=${updateStaleLinks}`);\n  }\n\n  async getFeatureLinksSummary() {\n    return this.doGet('/feature_links_summary');\n  }\n\n  async getFeatureLinksSamples(domain, type, isError) {\n    let optionalParams = '';\n    if (type) {\n      optionalParams += `&type=${type}`;\n    }\n    if (isError !== undefined && isError !== null) {\n      optionalParams += `&is_error=${isError}`;\n    }\n    return this.doGet(`/feature_links_samples?domain=${domain}${optionalParams}`);\n  }\n\n  // Stages API\n  async getStage(featureId, stageId) {\n    return this.doGet(`/features/${featureId}/stages/${stageId}`);\n  }\n\n  async deleteStage(featureId, stageId) {\n    return this.doDelete(`/features/${featureId}/stages/${stageId}`);\n  }\n\n  async createStage(featureId, body) {\n    return this.doPost(`/features/${featureId}/stages`, body);\n  }\n\n  async updateStage(featureId, stageId, body) {\n    return this.doPatch(`/features/${featureId}/stages/${stageId}`, body);\n  }\n\n  async addXfnGates(featureId, stageId) {\n    return this.doPost(\n        `/features/${featureId}/stages/${stageId}/addXfnGates`);\n  }\n\n  // Origin trials API\n  async getOriginTrials() {\n    return this.doGet('/origintrials');\n  }\n\n  async createOriginTrial(featureId, stageId, body) {\n    return this.doPost(`/origintrials/${featureId}/${stageId}/create`, body);\n  }\n\n  async extendOriginTrial(featureId, stageId, body) {\n    return this.doPatch(`/origintrials/${featureId}/${stageId}/extend`, body);\n  }\n\n  // Processes API\n  async getFeatureProcess(featureId) {\n    return this.doGet(`/features/${featureId}/process`);\n  }\n\n  // Progress API\n  async getFeatureProgress(featureId) {\n    return this.doGet(`/features/${featureId}/progress`);\n  }\n\n  // Blinkcomponents API\n  async getBlinkComponents() {\n    return this.doGet('/blinkcomponents');\n  }\n\n  // Channels API\n  async getChannels() {\n    return this.doGet('/channels');\n  }\n\n  async getSpecifiedChannels(start, end) {\n    return this.doGet(`/channels?start=${start}&end=${end}`);\n  }\n};\n\nexports.ChromeStatusClient = ChromeStatusClient;\nexports.FeatureNotFoundError = FeatureNotFoundError;\n})(window);\n"]}