{"version":3,"file":"chromedash-timeline.js","sourceRoot":"","sources":["../../../../client-src/elements/chromedash-timeline.ts"],"names":[],"mappings":"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","sourcesContent":["import { LitElement, css, html, nothing } from 'lit';\nimport { SHARED_STYLES } from '../css/shared-css.js';\nimport { showToastMessage } from './utils.js';\n\ninterface Property {\n    [key: string]: any;\n    0: number;\n    1: string;\n}\n\n\ndeclare global {\n    interface Window {\n        google: any;\n    }\n}\n\nclass ChromedashTimeline extends LitElement {\n    type: string;\n    view: string;\n    props: Property[];\n    selectedBucketId: string;\n    showAllHistoricalData: boolean;\n\n    static get properties() {\n        return {\n        type: {type: String},\n        view: {type: String},\n        props: {attribute: false},\n        selectedBucketId: {attribute: false},\n        showAllHistoricalData: {attribute: false},\n        };\n    }\n    constructor() {\n        super();\n        this.selectedBucketId = '1';\n        this.showAllHistoricalData = false;\n        this.type = '';\n        this.view = '';\n        this.props = [];\n    }\n\n  static get styles() {\n    return [\n      ...SHARED_STYLES,\n      css`\n        :host {\n          display: block;\n          flex: 1;\n          width: var(--max-content-width);\n        }\n\n        :host label {\n          margin-left: 8px;\n          cursor: pointer;\n        }\n\n        #chart {\n          margin-top: 15px;\n          width: 100%;\n          height: 450px;\n          background: var(--table-alternate-background);\n          border-radius: var(--border-radius);\n        }\n\n        #http-archive-data {\n          border: 0;\n          width: 100%;\n          height: 870px;\n        }\n\n        .header_title {\n          margin: 32px 0 15px 0;\n          font-weight: 500;\n          color: #000;\n        }\n\n        .description {\n          margin: 15px 0;\n        }\n\n        .callout {\n          padding: var(--content-padding);\n          margin-top: var(--content-padding);\n          background-color: var(--md-yellow-100);\n          border-color: rgba(27, 31, 35, 0.15);\n          line-height: 1.4;\n        }\n\n        #bigquery:empty {\n          display: none;\n        }\n\n        #bigquery {\n          font-family: 'Courier New', Courier, monospace;\n          font-weight: 600;\n          padding: 15px;\n          margin-bottom: 100px;\n          background: var(--table-alternate-background);\n          display: inline-block;\n        }\n\n        #datalist-input {\n          width: 20em;\n          border-radius: 10px;\n          height: 25px;\n          padding-left: 10px;\n          font-size: 15px;\n        }\n\n        sl-progress-bar {\n          --height: 4px;\n          --track-color: var(--barchart-foreground);\n          --indicator-color: var(--barchart-background);\n        }\n      `,\n    ];\n  }\n\nupdated() {\n    window.google.charts.setOnLoadCallback(this._updateTimeline.bind(this));\n}\n\nupdateSelectedBucketId(e) {\n    const inputValue = e.currentTarget.value;\n    const feature = this.props.find(el => el[1] === inputValue);\n    if (feature) {\n        this.selectedBucketId = feature[0].toString();\n    } else if (inputValue) {\n        showToastMessage('No matching features. Please try again!');\n    }\n}\n\n  toggleShowAllHistoricalData() {\n    this.showAllHistoricalData = !this.showAllHistoricalData;\n  }\n\n  firstUpdated() {\n    window.google.charts.load('current', {packages: ['corechart']});\n  }\n\n  drawVisualization(data, bucketId, showAllHistoricalData) {\n    const datatable = new google.visualization.DataTable();\n    datatable.addColumn('date', 'Date');\n    datatable.addColumn('number', 'Percentage');\n    datatable.addColumn({type: 'string', role: 'annotation'});\n    datatable.addColumn({type: 'string', role: 'annotationText'});\n\n    const rowArray: any[] = [];\n    for (let i = 0, item; (item = data[i]); ++i) {\n      const dateStr = item.date.split('-');\n      const date = new Date();\n      date.setFullYear(\n        parseInt(dateStr[0]),\n        parseInt(dateStr[1]) - 1,\n        parseInt(dateStr[2])\n      );\n      \n      const row: any[] = [date, parseFloat((item.day_percentage * 100).toFixed(6))];\n      // Add annotation where UMA data switched to new stuff.\n      if (item.date === '2017-10-27') {\n        row.push('A', 'Modernized metrics');\n      } else {\n        row.push(null, null);\n      }\n      rowArray.push(row);\n    }\n\n    datatable.addRows(rowArray);\n\n    function aggregateByMonth(date) {\n      const month = date.getMonth();\n      const year = date.getFullYear();\n      return new Date(year, month);\n    }\n\n    const groupedTable = window.google.visualization.data.group(\n      datatable,\n      [{column: 0, modifier: aggregateByMonth, type: 'date'}],\n      [\n        {\n          column: 1,\n          aggregation: window.google.visualization.data.avg,\n          type: 'number',\n          label: 'Monthly Average',\n        },\n      ],\n      [{column: 2, type: 'string'}]\n    );\n\n    const formatter = new window.google.visualization.NumberFormat({\n      fractionDigits: 6,\n    });\n    formatter.format(groupedTable, 1); // Apply formatter to percentage column.\n\n    let view = groupedTable;\n\n    if (!showAllHistoricalData) {\n      const startYear = new Date().getFullYear() - 2; // Show only 2 years of data by default.\n      view = new window.google.visualization.DataView(groupedTable);\n      view.setRows(\n        view.getFilteredRows([{column: 0, minValue: new Date(startYear, 0, 1)}])\n      );\n    }\n\n    const chartEl = this.shadowRoot!.querySelector('#chart');\n    const chart = new window.google.visualization.LineChart(chartEl);\n    chart.draw(view, {\n      backgroundColor: 'white',\n      legend: {position: 'none'},\n      curveType: 'function',\n      vAxis: {\n        title: '% page loads',\n        // maxValue: 100,\n        minValue: 0,\n      },\n      hAxis: {\n        title: 'Date',\n        format: 'MMM d, YYYY',\n      },\n      width: '100%',\n      height: '100%',\n      pointSize: 4,\n      series: {0: {color: '#4580c0'}},\n      trendlines: {\n        0: {\n          type: 'linear',\n          opacity: 0.5,\n          color: '#bdd6ed',\n          pointsVisible: false,\n        },\n      },\n    });\n  }\n\n  _updateTimeline() {\n    if (this.selectedBucketId === '1' || !this.props.length) return;\n\n    let url =\n      '/data/timeline/' +\n      this.type +\n      this.view +\n      '?bucket_id=' +\n      this.selectedBucketId;\n\n    // [DEV] Change to true to use the staging server endpoint for development\n    const devMode = false;\n    if (devMode) url = 'https://cr-status-staging.appspot.com' + url;\n\n    this._renderHTTPArchiveData();\n\n    // the chartEl's innerHTML will get overwritten once the chart is loaded\n    const chartEl = this.shadowRoot!.querySelector('#chart');\n    if (!chartEl!.innerHTML.includes('sl-progress-bar')) {\n      chartEl!.insertAdjacentHTML(\n        'afterbegin',\n        '<sl-progress-bar indeterminate></sl-progress-bar>'\n      );\n    }\n\n    const options: RequestInit = {credentials: 'omit'};\n    fetch(url, options)\n      .then(res => res.json())\n      .then(response => {\n        this.drawVisualization(\n          response,\n          this.selectedBucketId,\n          this.showAllHistoricalData\n        );\n      });\n\n    const currentUrl =\n      '/metrics/' +\n      this.type +\n      '/timeline/' +\n      this.view +\n      '/' +\n      this.selectedBucketId;\n    if (history.pushState && location.pathname != currentUrl) {\n      history.pushState({id: this.selectedBucketId}, '', currentUrl);\n    }\n  }\n\n  _renderHTTPArchiveData() {\n    const feature = this.props.find(\n      el => el[0] === parseInt(this.selectedBucketId)\n    );\n    if (feature) {\n      let featureName = feature[1];\n      const inputEl = this.shadowRoot!.querySelector('#datalist-input') as HTMLInputElement;\n      inputEl!.value = featureName;\n\n      if (this.type == 'css') {\n        featureName = convertToCamelCaseFeatureName(featureName);\n      }\n      const REPORT_ID = '1M8kXOqPkwYNKjJhtag_nvDNJCpvmw_ri';\n      const dsEmbedUrl = `https://datastudio.google.com/embed/reporting/${REPORT_ID}/page/tc5b?params=%7B\"df3\":\"include%25EE%2580%25800%25EE%2580%2580IN%25EE%2580%2580${featureName}\"%7D`;\n      const hadEl = this.shadowRoot!.querySelector('#http-archive-data') as HTMLIFrameElement;\n      hadEl!.src = dsEmbedUrl;\n\n      const bigqueryEl = this.shadowRoot!.querySelector('#bigquery') as HTMLElement;\n      bigqueryEl!.textContent = `#standardSQL\nSELECT yyyymmdd, client, pct_urls, sample_urls\nFROM \\`httparchive.blink_features.usage\\`\nWHERE feature = '${featureName}'\nAND yyyymmdd = (SELECT MAX(yyyymmdd) FROM \\`httparchive.blink_features.usage\\`)\nORDER BY yyyymmdd DESC, client`;\n    }\n  }\n\n  render() {\n    const note2017 = html`\n      <p class=\"callout\">\n        <b>Note</b>: on 2017-10-26 the underlying metrics were switched over to\n        a newer collection system which is\n        <a\n          href=\"https://groups.google.com/a/chromium.org/forum/#!msg/blink-api-owners-discuss/IpIkbz0qtrM/HUCfSMv2AQAJ\"\n          target=\"_blank\"\n          >more accurate</a\n        >. This is also the reason for the abrupt spike around 2017-10-26.\n      </p>\n    `;\n\n    return html`\n      <input\n        id=\"datalist-input\"\n        type=\"search\"\n        list=\"features\"\n        placeholder=\"Select or search a property\"\n        @change=\"${this.updateSelectedBucketId}\"\n      />\n      <datalist id=\"features\">\n        ${this.props.map(\n          prop => html`\n            <option\n              value=\"${prop[1]}\"\n              dataset-debug-bucket-id=\"${prop[0]}\"\n            ></option>\n          `\n        )}\n      </datalist>\n      <label>\n        Show all historical data:\n        <input\n          type=\"checkbox\"\n          ?checked=\"${this.showAllHistoricalData}\"\n          @change=\"${this.toggleShowAllHistoricalData}\"\n        />\n      </label>\n      <h3 id=\"usage\" class=\"header_title\">\n        Percentage of page loads over time\n      </h3>\n      <p class=\"description\">\n        The chart below shows the percentage of page loads (in Chrome) that use\n        this feature at least once. Data is across all channels and platforms.\n        Newly added use counters that are not on Chrome stable yet only have\n        data from the Chrome channels they're on.\n      </p>\n      <div id=\"chart\"></div>\n      ${this.showAllHistoricalData ? note2017 : nothing}\n      <h3 id=\"httparchive\" class=\"header_title\">\n        Adoption of the feature on top sites\n      </h3>\n      <p class=\"description\">\n        The chart below shows the adoption of the feature by the top URLs on the\n        internet. Data from\n        <a href=\"https://httparchive.org/\" target=\"_blank\">HTTP Archive</a>.\n      </p>\n      <iframe id=\"http-archive-data\"></iframe>\n      <p class=\"callout\">\n        <b>Note</b>: The jump around July and December 2018 are because the\n        corpus of URLs crawled by HTTP Archive increased. These jumps have no\n        correlation with the jump in the top graph. See the\n        <a\n          href=\"https://discuss.httparchive.org/t/changes-to-the-http-archive-corpus/1539\"\n          target=\"_blank\"\n          >announcement</a\n        >\n        for more details.\n      </p>\n      <p class=\"description\">\n        Copy and run this command in\n        <a href=\"https://bigquery.cloud.google.com\" target=\"_blank\">BigQuery</a>\n        to produce similar results:\n      </p>\n      <pre id=\"bigquery\"></pre>\n    `;\n  }\n}\n\n// Capitalizes the first letter of a word.\nfunction capitalize(word) {\n  const letters = word.split('');\n  letters[0] = letters[0].toUpperCase();\n  return letters.join('');\n}\n\n// Converts 'background-image' to 'CSSPropertyBackgroundImage'.\nfunction convertToCamelCaseFeatureName(property) {\n  return 'CSSProperty' + property.split('-').map(capitalize).join('');\n}\n\ncustomElements.define('chromedash-timeline', ChromedashTimeline);\n"]}